{
  "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "CompanyID":{
      "type": "string",
      "metadata": {
        "description": "numeric identification of company"
      }
    }
  },
  "variables": {
    "CompanyID" : "[parameters('CompanyID')]",
    "ResourceGroup":  "[resourceGroup().name]", // "[concat('Company', padleft(variables('CompanyID'), 2, '0') )]",
    "location": "[resourceGroup().location]",
    "ERCircuitName" : "[concat(variables('ResourceGroup'),'-er')]", 
    "VNetName": "Hub01-VNet01",
    "GWName" : "[concat(variables('VNetName'),'-gw')]",
    "PIPName" : "[concat(variables('GWName'), '-ip')]",
    "ConnectionName" : "[concat(variables('GWName') ,'-conn')]",
    "ASN" : "65021",
    "IPThirdOctet" : "[concat('1' , padLeft(variables('CompanyID'), 2, '0'))]",
    "VLANTag" :  "[concat('1',variables('ResourceGroup'),'0')]",

    "gatewaySubnetRef": "[resourceId(variables('ResourceGroup'), 'Microsoft.Network/virtualNetworks/subnets/', variables('VNetName'),'GatewaySubnet')]",
    "gatewayType" : "Expressroute",
    "gatewaySku" : "Standard"
  },
  "resources": [
    {
      "apiVersion": "2018-06-01",
      "type": "Microsoft.Network/publicIPAddresses",
      "name": "[variables('PIPName')]",
      "location": "[variables('location')]",
      "properties": {
        "publicIPAllocationMethod": "Dynamic"
      }
    },
    {
      "apiVersion":  "2018-06-01",
      "type": "Microsoft.Network/virtualNetworkGateways",
      "name": "[variables('GWName')]",
      "location": "[variables('location')]",
      "dependsOn": [
        "[concat('Microsoft.Network/publicIPAddresses/', variables('PIPName'))]"
      ],
      "properties": {
        "ipConfigurations": [
          {
            "properties": {
              "privateIPAllocationMethod": "Dynamic",
              "subnet": {
                "id": "[variables('gatewaySubnetRef')]"
              },
              "publicIPAddress": {
                "id": "[resourceId('Microsoft.Network/publicIPAddresses',variables('PIPName'))]"
              }
            },
            "name": "vnetGatewayConfig"
          }
        ],
        "gatewayType": "[variables('gatewayType')]",
        "sku": {
            "name": "[variables('gatewaySku')]",
            "tier": "[variables('gatewaySku')]"
        }
      }
    }
  ]
}